<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProAnz Analytics - Authentication</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-dark: #0f0f23;
        --secondary-dark: #1a1a2e;
        --accent-dark: #16213e;
        --highlight-dark: #0f3460;
        --accent-light: #e94560;
        --text-primary: #ffffff;
        --text-secondary: #b8bcc8;
        --border-dark: #2a2a4e;
        --success-dark: #00d4aa;
        --warning-dark: #ffa500;
        --error-dark: #ff4757;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary-dark) 0%,
          var(--secondary-dark) 50%,
          var(--accent-dark) 100%
        );
        min-height: 100vh;
        color: var(--text-primary);
        overflow-x: hidden;
      }

      .auth-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
      }

      .auth-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background:
          radial-gradient(
            circle at 20% 50%,
            rgba(233, 69, 96, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(15, 52, 96, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 20%,
            rgba(0, 212, 170, 0.05) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      .auth-card {
        background: rgba(26, 26, 46, 0.9);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-dark);
        border-radius: 20px;
        padding: 40px;
        width: 100%;
        max-width: 450px;
        box-shadow:
          0 20px 40px rgba(0, 0, 0, 0.4),
          0 0 60px rgba(233, 69, 96, 0.1),
          inset 0 0 20px rgba(255, 255, 255, 0.02);
        position: relative;
        z-index: 1;
        animation: slideUp 0.6s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .auth-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .auth-logo {
        width: 60px;
        height: 60px;
        background: linear-gradient(
          135deg,
          var(--accent-light),
          var(--highlight-dark)
        );
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 24px;
        font-weight: bold;
        color: white;
        box-shadow: 0 10px 25px rgba(233, 69, 96, 0.3);
      }

      .auth-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        background: linear-gradient(
          135deg,
          var(--text-primary),
          var(--text-secondary)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .auth-subtitle {
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
      }

      .toggle-container {
        display: flex;
        background: var(--accent-dark);
        border-radius: 12px;
        padding: 4px;
        margin-bottom: 30px;
        position: relative;
      }

      .toggle-btn {
        flex: 1;
        padding: 12px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
      }

      .toggle-btn.active {
        color: var(--text-primary);
        background: linear-gradient(
          135deg,
          var(--accent-light),
          var(--highlight-dark)
        );
        box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
      }

      .form-container {
        display: none;
        animation: fadeIn 0.4s ease-out;
      }

      .form-container.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        color: var(--text-secondary);
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .form-control {
        width: 100%;
        padding: 14px 16px;
        background: var(--primary-dark);
        border: 2px solid var(--border-dark);
        border-radius: 10px;
        color: var(--text-primary);
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--accent-light);
        box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.1);
        background: rgba(15, 15, 35, 0.8);
      }

      .form-control::placeholder {
        color: var(--text-secondary);
        opacity: 0.7;
      }

      .input-group {
        position: relative;
      }

      .input-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 16px;
        z-index: 1;
      }

      .input-group .form-control {
        padding-left: 45px;
      }

      .btn-auth {
        width: 100%;
        padding: 14px;
        background: linear-gradient(
          135deg,
          var(--accent-light),
          var(--highlight-dark)
        );
        border: none;
        border-radius: 10px;
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-auth:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(233, 69, 96, 0.4);
      }

      .btn-auth:active {
        transform: translateY(0);
      }

      .btn-auth::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn-auth:hover::before {
        left: 100%;
      }

      .btn-auth:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .alert {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: none;
        font-size: 14px;
        font-weight: 500;
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .alert-success {
        background: rgba(0, 212, 170, 0.1);
        color: var(--success-dark);
        border: 1px solid rgba(0, 212, 170, 0.3);
      }

      .alert-danger {
        background: rgba(255, 71, 87, 0.1);
        color: var(--error-dark);
        border: 1px solid rgba(255, 71, 87, 0.3);
      }

      .loading-spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .btn-auth.loading .btn-text {
        display: none;
      }

      .btn-auth.loading .loading-spinner {
        display: block;
      }

      .password-strength {
        margin-top: 8px;
        height: 4px;
        background: var(--border-dark);
        border-radius: 2px;
        overflow: hidden;
      }

      .password-strength-bar {
        height: 100%;
        width: 0;
        transition: all 0.3s ease;
        border-radius: 2px;
      }

      .password-strength-bar.weak {
        width: 33%;
        background: var(--error-dark);
      }

      .password-strength-bar.medium {
        width: 66%;
        background: var(--warning-dark);
      }

      .password-strength-bar.strong {
        width: 100%;
        background: var(--success-dark);
      }

      .form-footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-dark);
      }

      .form-footer-text {
        color: var(--text-secondary);
        font-size: 14px;
      }

      .form-footer-link {
        color: var(--accent-light);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
      }

      .form-footer-link:hover {
        color: var(--text-primary);
        text-decoration: underline;
      }

      @media (max-width: 480px) {
        .auth-card {
          padding: 30px 20px;
          margin: 10px;
        }

        .auth-title {
          font-size: 24px;
        }

        .toggle-btn {
          font-size: 13px;
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div
            class="auth-logo"
            style="
              background: linear-gradient(
                to bottom right,
                #06b6d4,
                #a855f7,
                #ec4899
              );
            "
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              style="width: 32px; height: 32px; color: white"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 2L2 7l10 5 10-5-10-5z" />
              <path d="M2 17l10 5 10-5" />
              <path d="M2 12l10 5 10-5" />
            </svg>
          </div>
          <h1 class="auth-title">
            ShopSense<span style="color: #22d3ee">AI</span>
          </h1>
          <p class="auth-subtitle">Advanced Sales & Product Intelligence</p>
          <div class="mt-2">
            <a
              href="http://localhost:5173"
              class="form-footer-link"
              style="font-size: 0.8rem"
            >
              <i class="fas fa-arrow-left me-1"></i> Back to Home
            </a>
          </div>
        </div>

        <div class="toggle-container">
          <button class="toggle-btn active" onclick="toggleForm('login')">
            <i class="fas fa-sign-in-alt me-2"></i>Login
          </button>
          <button class="toggle-btn" onclick="toggleForm('register')">
            <i class="fas fa-user-plus me-2"></i>Register
          </button>
        </div>

        <div id="alert-container"></div>

        <!-- Login Form -->
        <div id="login-form" class="form-container active">
          <form id="loginForm">
            <div class="form-group">
              <label class="form-label">Username or Email</label>
              <div class="input-group">
                <i class="fas fa-user input-icon"></i>
                <input
                  type="text"
                  class="form-control"
                  id="loginUsername"
                  placeholder="Enter username or email"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="input-group">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  class="form-control"
                  id="loginPassword"
                  placeholder="Enter password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn-auth">
              <span class="btn-text">
                <i class="fas fa-sign-in-alt me-2"></i>Sign In
              </span>
              <div class="loading-spinner"></div>
            </button>
          </form>
        </div>

        <!-- Register Form -->
        <div id="register-form" class="form-container">
          <form id="registerForm">
            <div class="form-group">
              <label class="form-label">Username</label>
              <div class="input-group">
                <i class="fas fa-user input-icon"></i>
                <input
                  type="text"
                  class="form-control"
                  id="registerUsername"
                  placeholder="Choose a username"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Email Address</label>
              <div class="input-group">
                <i class="fas fa-envelope input-icon"></i>
                <input
                  type="email"
                  class="form-control"
                  id="registerEmail"
                  placeholder="Enter your email"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <div class="input-group">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  class="form-control"
                  id="registerPassword"
                  placeholder="Create a password"
                  required
                />
              </div>
              <div class="password-strength">
                <div class="password-strength-bar" id="passwordStrength"></div>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Confirm Password</label>
              <div class="input-group">
                <i class="fas fa-lock input-icon"></i>
                <input
                  type="password"
                  class="form-control"
                  id="confirmPassword"
                  placeholder="Confirm your password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn-auth">
              <span class="btn-text">
                <i class="fas fa-user-plus me-2"></i>Create Account
              </span>
              <div class="loading-spinner"></div>
            </button>
          </form>
        </div>

        <div class="form-footer">
          <p class="form-footer-text">
            <span id="footer-text">Don't have an account?</span>
            <a
              href="#"
              class="form-footer-link"
              onclick="toggleForm('register')"
              id="footer-link"
              >Sign up</a
            >
          </p>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let currentForm = "login";

      function toggleForm(formType) {
        currentForm = formType;

        // Update toggle buttons
        document
          .querySelectorAll(".toggle-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Update forms
        document
          .querySelectorAll(".form-container")
          .forEach((form) => form.classList.remove("active"));
        document.getElementById(`${formType}-form`).classList.add("active");

        // Update footer
        const footerText = document.getElementById("footer-text");
        const footerLink = document.getElementById("footer-link");

        if (formType === "login") {
          footerText.textContent = "Don't have an account? ";
          footerLink.textContent = "Sign up";
          footerLink.setAttribute("onclick", 'toggleForm("register")');
        } else {
          footerText.textContent = "Already have an account? ";
          footerLink.textContent = "Sign in";
          footerLink.setAttribute("onclick", 'toggleForm("login")');
        }

        // Clear alerts
        clearAlerts();
      }

      function showAlert(message, type) {
        const alertContainer = document.getElementById("alert-container");
        const alertDiv = document.createElement("div");
        alertDiv.className = `alert alert-${type}`;
        alertDiv.innerHTML = `
                <i class="fas fa-${type === "success" ? "check-circle" : "exclamation-triangle"} me-2"></i>
                ${message}
            `;
        alertContainer.appendChild(alertDiv);

        // Auto-remove after 5 seconds
        setTimeout(() => {
          alertDiv.remove();
        }, 5000);
      }

      function clearAlerts() {
        document.getElementById("alert-container").innerHTML = "";
      }

      function setLoading(button, loading) {
        if (loading) {
          button.classList.add("loading");
          button.disabled = true;
        } else {
          button.classList.remove("loading");
          button.disabled = false;
        }
      }

      function checkPasswordStrength(password) {
        const strengthBar = document.getElementById("passwordStrength");
        let strength = 0;

        if (password.length >= 6) strength++;
        if (password.length >= 10) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/\d/.test(password)) strength++;
        if (/[^a-zA-Z\d]/.test(password)) strength++;

        strengthBar.className = "password-strength-bar";
        if (strength <= 2) {
          strengthBar.classList.add("weak");
        } else if (strength <= 4) {
          strengthBar.classList.add("medium");
        } else {
          strengthBar.classList.add("strong");
        }
      }

      // Password strength checker
      document
        .getElementById("registerPassword")
        .addEventListener("input", (e) => {
          checkPasswordStrength(e.target.value);
        });

      // Login form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          clearAlerts();

          const username = document
            .getElementById("loginUsername")
            .value.trim();
          const password = document.getElementById("loginPassword").value;
          const submitBtn = e.target.querySelector(".btn-auth");

          if (!username || !password) {
            showAlert("Please fill in all fields", "danger");
            return;
          }

          setLoading(submitBtn, true);

          try {
            const response = await fetch("/api/auth/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username_or_email: username,
                password: password,
              }),
            });

            const data = await response.json();

            if (data.success) {
              showAlert("Login successful! Redirecting...", "success");
              setTimeout(() => {
                window.location.href = "/";
              }, 1500);
            } else {
              showAlert(data.error || "Login failed", "danger");
            }
          } catch (error) {
            showAlert("Network error. Please try again.", "danger");
          } finally {
            setLoading(submitBtn, false);
          }
        });

      // Register form submission
      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          clearAlerts();

          const username = document
            .getElementById("registerUsername")
            .value.trim();
          const email = document.getElementById("registerEmail").value.trim();
          const password = document.getElementById("registerPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;
          const submitBtn = e.target.querySelector(".btn-auth");

          if (!username || !email || !password || !confirmPassword) {
            showAlert("Please fill in all fields", "danger");
            return;
          }

          if (password.length < 6) {
            showAlert("Password must be at least 6 characters", "danger");
            return;
          }

          if (password !== confirmPassword) {
            showAlert("Passwords do not match", "danger");
            return;
          }

          setLoading(submitBtn, true);

          try {
            const response = await fetch("/api/auth/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: username,
                email: email,
                password: password,
                confirm_password: confirmPassword,
              }),
            });

            const data = await response.json();

            if (data.success) {
              showAlert("Registration successful! Redirecting...", "success");
              setTimeout(() => {
                window.location.href = "/";
              }, 1500);
            } else {
              showAlert(data.error || "Registration failed", "danger");
            }
          } catch (error) {
            showAlert("Network error. Please try again.", "danger");
          } finally {
            setLoading(submitBtn, false);
          }
        });
    </script>
  </body>
</html>
